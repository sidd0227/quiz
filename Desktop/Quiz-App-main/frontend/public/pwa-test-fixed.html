<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#16213e">
    <title>PWA Test - Fixed Install Button</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }
        .install-btn {
            background: linear-gradient(45deg, #48bb78, #38a169);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin: 10px;
            transition: transform 0.2s;
        }
        .install-btn:hover {
            transform: translateY(-2px);
        }
        .install-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .status {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            font-family: monospace;
        }
        .success { background: rgba(40, 167, 69, 0.3); }
        .warning { background: rgba(255, 193, 7, 0.3); }
        .error { background: rgba(220, 53, 69, 0.3); }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß PWA Install Button - Fixed</h1>
        
        <div id="status" class="status">
            Checking PWA status...
        </div>

        <button id="install-btn" class="install-btn" disabled>
            üì± Loading...
        </button>

        <button id="debug-btn" class="install-btn">
            üîç Debug Status
        </button>

        <button id="force-check" class="install-btn">
            üîÑ Force Check
        </button>

        <div id="console" class="status" style="max-height: 300px; overflow-y: auto;">
            <strong>Console Output:</strong><br>
        </div>
    </div>

    <script type="module">
        import pwaManager from '/src/utils/pwaUtils.js';

        let consoleDiv = document.getElementById('console');
        let statusDiv = document.getElementById('status');
        let installBtn = document.getElementById('install-btn');
        let debugBtn = document.getElementById('debug-btn');
        let forceCheckBtn = document.getElementById('force-check');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            console.log(logEntry);
            
            consoleDiv.innerHTML += `<div style="color: ${type === 'error' ? '#ff6b6b' : type === 'success' ? '#51cf66' : 'white'}">${logEntry}</div>`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        function updateStatus() {
            const info = pwaManager.getInstallationInfo();
            log('üì± PWA Status: ' + JSON.stringify(info));
            
            statusDiv.innerHTML = `
                <strong>PWA Status:</strong><br>
                ‚Ä¢ Installed: ${info.isInstalled ? '‚úÖ' : '‚ùå'}<br>
                ‚Ä¢ Can Install: ${info.canInstall ? '‚úÖ' : '‚ùå'}<br>
                ‚Ä¢ Has Prompt: ${info.hasPrompt ? '‚úÖ' : '‚ùå'}<br>
                ‚Ä¢ Installable: ${info.isInstallable ? '‚úÖ' : '‚ùå'}<br>
                ‚Ä¢ Display Mode: ${info.displayMode}
            `;
            
            statusDiv.className = 'status ' + (info.canInstall ? 'success' : info.isInstalled ? 'warning' : 'error');
            
            // Update button
            if (info.isInstalled) {
                installBtn.textContent = '‚úÖ Already Installed';
                installBtn.disabled = true;
            } else if (info.canInstall) {
                installBtn.textContent = 'üì± Install App';
                installBtn.disabled = false;
            } else {
                installBtn.textContent = 'üìã Show Install Guide';
                installBtn.disabled = false;
            }
        }

        // Event listeners
        installBtn.addEventListener('click', async () => {
            log('üöÄ Install button clicked');
            const result = await pwaManager.promptInstall();
            log(`üì± Install result: ${result}`, result ? 'success' : 'warning');
            setTimeout(updateStatus, 1000);
        });

        debugBtn.addEventListener('click', () => {
            if (window.pwaDebug) {
                window.pwaDebug.checkStatus();
                window.pwaDebug.checkCriteria();
            } else {
                log('‚ùå PWA Debug not available', 'error');
            }
        });

        forceCheckBtn.addEventListener('click', () => {
            log('üîÑ Forcing PWA installability check');
            pwaManager.checkInstallability();
            setTimeout(updateStatus, 2000);
        });

        // Listen for PWA events
        window.addEventListener('pwa-installable', () => {
            log('üéØ PWA became installable!', 'success');
            updateStatus();
        });

        window.addEventListener('pwa-installed', () => {
            log('üéâ PWA was installed!', 'success');
            updateStatus();
        });

        // Initialize
        log('üöÄ PWA Test page loaded');
        setTimeout(updateStatus, 1000);
        
        // Update status periodically
        setInterval(updateStatus, 5000);
    </script>
</body>
</html>
